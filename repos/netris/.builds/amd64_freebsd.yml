arch: amd64
environment:
  PROJECT_DIR: '~/go/src/git.sr.ht/~tslocum'
  PROJECT_NAME: 'netris'
  CGO_ENABLED: '0'
  GO111MODULE: 'on'
image: freebsd/latest
packages:
  - go
sources:
  - https://git.sr.ht/~tslocum/netris
tasks:
  - setup: |
      mkdir -p $PROJECT_DIR
      mv $PROJECT_NAME $PROJECT_DIR/$PROJECT_NAME
  - deps: |
      cd $PROJECT_DIR/$PROJECT_NAME
      go mod download
  - test: |
      cd $PROJECT_DIR/$PROJECT_NAME
      go test ./...
  - build-client: |
      cd $PROJECT_DIR/$PROJECT_NAME/cmd/netris
      go build
  - build-server: |
      cd $PROJECT_DIR/$PROJECT_NAME/cmd/netris-server
      go build
